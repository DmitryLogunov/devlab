FROM node:8-alpine

WORKDIR /usr/src/app

RUN apk update && \
    apk --no-cache add \
    bash \
    openssh \
    python \
    git \
    yarn --repository http://dl-3.alpinelinux.org/alpine/edge/community/ --allow-untrusted

RUN echo '{"config": {"unsafe-perm":true } }' >> ~/.npmrc && \
    echo "chmod -R 600 ~/.ssh/ && chown -R root ~/.ssh/" >> ~/entrypoint && \
    echo "ssh-keyscan -H github.com >> /root/.ssh/known_hosts" >> ~/entrypoint && \
    echo "ssh -o 'StrictHostKeyChecking=no' git@github.com " >> ~/entrypoint && \
    echo "(cd /usr/src/app && sh /usr/src/app/install)" >> ~/entrypoint && \
    chmod +x ~/entrypoint

CMD ~/entrypoint